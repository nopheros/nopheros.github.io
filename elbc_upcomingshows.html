<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Upcoming Everlook Broadcasting Co. Shows">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title>Upcoming Everlook Broadcasting Co. Shows â€” DJ NOPHEROS</title>

    <!-- Favicon -->
    <link rel="icon" href="/video/nopheros_glitchlogo_transparent.gif" type="image/gif">
    <link rel="icon" href="/video/nopheros_glitchlogo_transparent.gif" sizes="any">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css">

    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.css" rel="stylesheet">

    <style>
      html, body { background-color: #000 !important; color: #fff; }
      .page-main { padding: 120px 0; text-align: center; }
      .page-main h1 { color: #fff; letter-spacing: 6px; font-family: "Archivo Narrow", sans-serif; font-weight:700; }
      .page-main p { color: #dcdcdc; max-width: 900px; margin: 0 auto 40px; line-height:1.8; }
      .calendar-wrap { display:flex; justify-content:center; width:100%; }
      .calendar-container { width:100%; max-width:1000px; margin:0 auto; }
      #calendar { background:#111; border:1px solid rgba(255,255,255,0.06); border-radius:6px; padding:20px; }
      .tz-controls { display:inline-flex; justify-content:center; gap:0; align-items:center; margin-bottom:30px; flex-wrap:nowrap; }
      .tz-controls > * { margin:0; }
      .tz-controls label { margin-right:8px; }
      .tz-controls select, .tz-controls input { background:#111; color:#fff; border:1px solid rgba(255,255,255,0.06); padding:8px 10px; border-radius:6px; margin:0; }
      .tz-controls .oneMusic-btn { background:transparent; border:1px solid rgba(255,255,255,0.08); color:#fff; padding:8px 12px; border-radius:6px; cursor:pointer; margin:0 0 0 8px; }
      /* FullCalendar dark theme overrides */
      .fc { font-family: "Archivo Narrow", sans-serif; }
      .fc-button-primary { background-color:#333; border-color:#555; }
      .fc-button-primary:hover { background-color:#444; }
      .fc-button-primary.fc-button-active { background-color:#555; }
      .fc-daygrid-day.fc-day-today { background-color:rgba(255,255,255,0.05); }
      .fc-col-header-cell { color:#ddd; border-color:rgba(255,255,255,0.1); }
      .fc-daygrid-day { color:#ddd; border-color:rgba(255,255,255,0.1); }
      .fc-daygrid-day-number { color:#ddd; }
      .fc-daygrid-day-frame { min-height:100px; }
      .fc-event { background-color:#4a90e2; border-color:#3a7bc8; padding:2px 4px; }
      .fc-event-title { color:#fff; font-weight:600; font-size:0.9rem; }
      .fc-event-time { color:#e0e0e0; font-size:0.85rem; }
      .fc-event:hover { background-color:#5aa3f0; }
      .fc-toolbar { margin-bottom:20px; }
      .fc-toolbar-title { color:#ddd; font-size:1.5rem; }
      .event-emoji { margin-right:4px; }
      #calendar-loading { color:#ddd; padding:40px; text-align:center; }
      #calendar-error { color:#ff6b6b; padding:40px; text-align:center; }
      @media (max-width: 991px){ #calendar { padding:15px; } }
      @media (max-width: 480px){ #calendar { padding:10px; } }
    </style>
</head>

<body>
    <!-- header (re-used consistent header) -->
    <header class="header-area">
        <div class="oneMusic-main-menu">
            <div class="classy-nav-container breakpoint-off">
                <div class="container">
                    <nav class="classy-navbar justify-content-between" id="oneMusicNav">
                        <a href="/index.html" class="nav-brand nav-brand-text">DJ NOPHEROS</a>
                        <div class="classy-navbar-toggler">
                            <span class="navbarToggler"><span></span><span></span><span></span></span>
                        </div>
                        <div class="classy-menu">
                            <div class="classycloseIcon">
                                <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
                            </div>
                            <div class="classynav">
                                <ul>
                                    <li><a href="/index.html">Home</a></li>
                                    <li><a href="#">DJ</a>
                                        <ul class="dropdown">
                                            <li><a href="/dj.html">DJ Page</a></li>
                                            <li><a href="https://www.youtube.com/@Nopheros" target="_blank">YouTube VODs</a></li>
                                            <li><a href="https://www.twitch.tv/nopheros" target="_blank">Twitch</a></li>
                                            <li><a href="https://archive.org/details/@nopheros" target="_blank">Show Archives</a></li>
                                            <li><a href="mailto:nopheros.media@gmail.com?subject=Booking%20Inquiry%20-%20DJ%20Nopheros" onclick="window.open(this.href); return false;">Bookings</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="#">Broadcaster</a>
                                        <ul class="dropdown">
                                            <li><a href="/broadcaster.html">Broadcaster Page</a></li>
                                            <li><a href="/elbc_upcomingshows.html">Upcoming Shows</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="/voice-actor.html">Voice Actor</a></li>
                                    <li><a href="/writer.html">Writer</a></li>
                                    <li><a href="#">About Me</a>
                                        <ul class="dropdown">
                                            <li><a href="/aboutme.html">The story so far</a></li>
                                            <li><a href="https://linktr.ee/nopheros" target="_blank">Socials</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="mailto:nopheros.media@gmail.com?subject=Booking%20Inquiry%20-%20DJ%20Nopheros" onclick="window.open(this.href); return false;">Bookings</a></li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main class="page-main">
      <div class="container">
        <h1>Upcoming Everlook Broadcasting Co. Shows</h1>
                <p>Live schedule for Everlook Broadcasting Company. If the calendar does not load, try opening it directly in a new tab.</p>

                <div class="tz-controls" aria-hidden="false">
                    <label for="tzSelect" style="color:#ddd;">Timezone:</label>
                    <select id="tzSelect" aria-label="Select timezone">
                        <option value="AUTO">Automatic (browser)</option>
                        <option value="UTC">UTC</option>
                        <option value="America/New_York">America / New_York</option>
                        <option value="America/Los_Angeles">America / Los_Angeles</option>
                        <option value="Europe/London">Europe / London</option>
                        <option value="Europe/Berlin">Europe / Berlin</option>
                        <option value="Asia/Tokyo">Asia / Tokyo</option>
                        <option value="Australia/Sydney">Australia / Sydney</option>
                        <option value="OTHER">Otherâ€¦</option>
                    </select>

                    <input id="tzOther" type="text" placeholder="Enter IANA timezone e.g. Pacific/Auckland" style="display:none;" />

                    <button id="openCalendar" class="oneMusic-btn">Open in Google Calendar</button>
                </div>

                <div class="calendar-wrap">
                    <div class="calendar-container">
                        <div id="calendar"></div>
                        <div id="calendar-loading" style="display:none; width:100%; max-width:1000px;">Loading calendar events...</div>
                        <div id="calendar-error" style="display:none; width:100%; max-width:1000px;"></div>
                    </div>
                </div>

      </div>
    </main>

    <footer class="footer-area">
        <div class="container">
            <div class="row d-flex flex-wrap align-items-center">
                <div class="col-12 col-md-4">
                    <a href="/index.html" class="footer-brand">DJ NOPHEROS</a>
                    <p class="copywrite-text">Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | You're gonna carry that weight</p>
                </div>
                <div class="col-12 col-md-4">
                    <div class="footer-nav">
                        <ul>
                            <li><a href="/index.html">home</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-12 col-md-4" style="text-align: center;">
                    <a href="https://discord.gg/8CnBtGVQJr" target="_blank" rel="noopener" style="display: inline-block; color: #9fd8ff; text-decoration: none; font-family: 'Share Tech Mono', monospace; letter-spacing: 1px; font-size: 0.9rem; transition: color 0.2s ease;">ðŸ“¡ JOIN THE SIGNAL ON DISCORD</a>
                </div>
            </div>
        </div>
    </footer>

        <script src="js/jquery/jquery-2.2.4.min.js"></script>
        <script src="js/bootstrap/popper.min.js"></script>
        <script src="js/bootstrap/bootstrap.min.js"></script>
        <script src="js/plugins/plugins.js"></script>
        <script src="js/active.js"></script>

        <!-- FullCalendar JS -->
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>

        <script>
          (function(){
            // Google Calendar public iCal feed URL (no API key needed, no CORS issues)
            const ICAL_URL = 'https://calendar.google.com/calendar/ical/3ca3313af031d22bb22859954819396567d21792510e9c26151fdbfee803ffb5%40group.calendar.google.com/public/basic.ics';
            const GOOGLE_CALENDAR_URL = 'https://calendar.google.com/calendar/u/2?cid=M2NhMzMxM2FmMDMxZDIyYmIyMjg1OTk1NDgxOTM5NjU2N2QyMTc5MjUxMGU5YzI2MTUxZmRiZmVlODAzZmZiNUBncm91cC5jYWxlbmRhci5nb29nbGUuY29t';

            const tzSelect = document.getElementById('tzSelect');
            const tzOther = document.getElementById('tzOther');
            const openBtn = document.getElementById('openCalendar');
            const calendarEl = document.getElementById('calendar');
            const loadingEl = document.getElementById('calendar-loading');
            const errorEl = document.getElementById('calendar-error');

            let calendar = null;

            function detectTZ(){
              try{ return Intl.DateTimeFormat().resolvedOptions().timeZone || 'UTC'; }catch(e){ return 'UTC'; }
            }

            function getSavedTz(){ return localStorage.getItem('elbc_tz'); }

            function applyTimezone(tz){
              if(calendar){
                calendar.setOption('timeZone', tz);
              }
              localStorage.setItem('elbc_tz', tz);
            }

            function applySelection(value){
              if(value === 'AUTO'){
                tzOther.style.display = 'none';
                const tz = detectTZ();
                applyTimezone(tz);
                localStorage.removeItem('elbc_tz');
              } else if(value === 'OTHER'){
                tzOther.style.display = '';
                tzOther.focus();
                const custom = tzOther.value.trim() || detectTZ();
                applyTimezone(custom);
              } else {
                tzOther.style.display = 'none';
                applyTimezone(value);
              }
              openBtn.onclick = () => window.open(GOOGLE_CALENDAR_URL, '_blank');
            }

            // Initialize timezone selector
            (function initTZ(){
              const saved = getSavedTz();
              const autoTz = detectTZ();
              if(saved){
                const found = Array.from(tzSelect.options).some(opt => opt.value === saved);
                if(found){ 
                  tzSelect.value = saved; 
                  tzOther.style.display = 'none'; 
                } else { 
                  tzSelect.value = 'OTHER'; 
                  tzOther.style.display = ''; 
                  tzOther.value = saved; 
                }
              } else {
                tzSelect.value = 'AUTO'; 
                tzOther.style.display = 'none'; 
              }

              tzSelect.addEventListener('change', (e) => applySelection(e.target.value));
              tzOther.addEventListener('change', () => {
                const v = tzOther.value.trim() || detectTZ();
                applyTimezone(v);
              });

              openBtn.onclick = () => window.open(GOOGLE_CALENDAR_URL, '_blank');
            })();

            // Parse iCal format and extract events
            async function parseICalEvents(){
              try{
                loadingEl.style.display = 'block';
                errorEl.style.display = 'none';
                calendarEl.style.display = 'none';

                const response = await fetch(ICAL_URL);
                if(!response.ok) throw new Error(`Failed to fetch calendar: ${response.status}`);

                const icalText = await response.text();
                console.log('iCal data retrieved, length:', icalText.length);
                
                // Parse iCal events
                const events = [];
                const eventRegex = /BEGIN:VEVENT([\s\S]*?)END:VEVENT/g;
                let match;
                
                while((match = eventRegex.exec(icalText)) !== null){
                  const eventText = match[1];
                  
                  // Extract title/summary
                  const summaryMatch = eventText.match(/SUMMARY:(.+?)(?:\r?\n|$)/);
                  const title = summaryMatch ? summaryMatch[1].trim() : 'Event';
                  
                  // Extract start date
                  const startMatch = eventText.match(/DTSTART(?:;[^:]*)?:(.+?)(?:\r?\n|$)/);
                  const startStr = startMatch ? startMatch[1].trim() : null;
                  
                  // Extract end date
                  const endMatch = eventText.match(/DTEND(?:;[^:]*)?:(.+?)(?:\r?\n|$)/);
                  const endStr = endMatch ? endMatch[1].trim() : null;
                  
                  // Extract location
                  const locationMatch = eventText.match(/LOCATION:(.+?)(?:\r?\n|$)/);
                  const location = locationMatch ? locationMatch[1].trim() : '';
                  
                  if(startStr){
                    // Parse iCal date format (YYYYMMDD or YYYYMMDDTHHMMSS or YYYYMMDDTHHMMSSZ)
                    const parseICalDate = (dateStr) => {
                      if(!dateStr) return null;
                      if(dateStr.length === 8) {
                        // All-day event: YYYYMMDD
                        return dateStr.substring(0, 4) + '-' + dateStr.substring(4, 6) + '-' + dateStr.substring(6, 8);
                      } else {
                        // Timed event: YYYYMMDDTHHmmss or YYYYMMDDTHHmmssZ
                        const y = dateStr.substring(0, 4);
                        const m = dateStr.substring(4, 6);
                        const d = dateStr.substring(6, 8);
                        const t = dateStr.substring(9, 15);
                        const h = t.substring(0, 2);
                        const min = t.substring(2, 4);
                        const s = t.substring(4, 6);
                        return `${y}-${m}-${d}T${h}:${min}:${s}`;
                      }
                    };
                    
                    const start = parseICalDate(startStr);
                    const end = parseICalDate(endStr) || start;
                    
                    // Choose emoji based on title
                    let emoji = 'ðŸ“…';
                    if(title.toLowerCase().includes('live dj') || title.toLowerCase().includes('dj')) emoji = 'ðŸŽµ';
                    else if(title.toLowerCase().includes('show')) emoji = 'ðŸŽ™ï¸';
                    else if(title.toLowerCase().includes('broadcast')) emoji = 'ðŸ“»';
                    
                    events.push({
                      title: `${emoji} ${title}`,
                      start: start,
                      end: end,
                      backgroundColor: '#4a90e2',
                      borderColor: '#3a7bc8',
                      extendedProps: {
                        originalTitle: title,
                        location: location
                      }
                    });
                    
                    console.log('Parsed event:', title, 'Start:', start);
                  }
                }
                
                console.log('Total events parsed:', events.length);
                return events;
              } catch(err){
                console.error('Error parsing iCal:', err);
                errorEl.textContent = `Error loading calendar: ${err.message}`;
                errorEl.style.display = 'block';
                loadingEl.style.display = 'none';
                return [];
              }
            }

            // Initialize FullCalendar
            document.addEventListener('DOMContentLoaded', async () => {
              const events = await parseICalEvents();

              if(events.length > 0 || !errorEl.style.display){
                const savedTz = getSavedTz() || detectTZ();

                calendar = new FullCalendar.Calendar(calendarEl, {
                  initialView: 'dayGridMonth',
                  headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: ''
                  },
                  height: 'auto',
                  contentHeight: 'auto',
                  timeZone: savedTz,
                  events: events,
                  eventDisplay: 'block',
                  eventContent: function(arg) {
                    const title = arg.event.title;
                    let details = '';
                    if(arg.event.extendedProps.location) {
                      details += `<div style="font-size:0.8rem; opacity:0.9;">${arg.event.extendedProps.location}</div>`;
                    }
                    if(arg.event.start && arg.event.start.toLocaleTimeString) {
                      const time = arg.event.start.toLocaleTimeString('en-US', {hour: '2-digit', minute:'2-digit'});
                      details += `<div style="font-size:0.8rem; opacity:0.85;">${time}</div>`;
                    }
                    return { html: `<strong>${title}</strong>${details}` };
                  }
                });

                calendar.render();
                loadingEl.style.display = 'none';
                calendarEl.style.display = 'block';
              }
            });

          })();
        </script>
</body>

</html>
